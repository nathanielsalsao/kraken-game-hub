<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>KRAKEN // DATA_RECOVERY</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        :root { 
            --neon: #00f2ff; 
            --warning: #ff003c;
            --safe: #00ff88;
            --bg-dark: #00040a;
            --panel-bg: rgba(0, 15, 25, 0.9);
            --glow: drop-shadow(0 0 10px var(--neon));
        }

        * { box-sizing: border-box; }
        html, body { 
            margin: 0; padding: 0; width: 100%; height: 100%;
            background: var(--bg-dark); font-family: 'Orbitron', sans-serif; 
            color: #fff; text-transform: uppercase; overflow: hidden;
            transition: opacity 2s ease-in-out; 
        }

        #abort-overlay {
            position: fixed; inset: 0;
            background: radial-gradient(circle, rgba(20, 0, 5, 0.95) 0%, rgba(0, 0, 0, 1) 100%);
            z-index: 5000;
            display: none; 
            flex-direction: column;
            justify-content: center;
            align-items: center;
            pointer-events: none;
            border-top: 2px solid var(--warning);
            border-bottom: 2px solid var(--warning);
        }

        #abort-overlay::after {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 3px;
            background: var(--warning);
            box-shadow: 0 0 20px var(--warning);
            animation: abort-scan 0.6s linear infinite;
        }

        .abort-text {
            font-size: 6rem;
            font-weight: 900;
            color: #fff;
            text-shadow: 0 0 20px var(--warning);
            letter-spacing: 20px;
            margin: 0;
            animation: glitch-vibrate 0.15s infinite;
        }

        .abort-subtext {
            font-family: 'Share Tech Mono';
            font-size: 1.1rem;
            color: var(--warning);
            padding: 5px 20px;
            margin-top: 15px;
            letter-spacing: 5px;
            border-left: 2px solid var(--warning);
        }
        @keyframes abort-scan {
            0% { top: 0%; opacity: 0; }
            50% { opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }

        @keyframes glitch-vibrate {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px) skewX(2deg); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px) skewX(-2deg); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }

        .system-crash {
            filter: brightness(0.4) contrast(1.5) blur(15px) grayscale(1);
            transition: all 2s cubic-bezier(0.4, 0, 1, 1) !important;
        }

        body::before {
            content: " "; position: absolute; inset: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.2) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
            background-size: 100% 3px, 3px 100%; z-index: 1000; pointer-events: none;
        }

        .nav-header { position: fixed; top: 20px; left: 20px; z-index: 200; }
        .back-vault {
            background: transparent; border: 1px solid var(--neon);
            color: var(--neon); font-family: 'Share Tech Mono';
            padding: 8px 15px; cursor: pointer; text-decoration: none;
            font-size: 12px; letter-spacing: 2px; transition: 0.3s;
            clip-path: polygon(0 0, 100% 0, 85% 100%, 0% 100%);
            display: flex; align-items: center; gap: 8px;
        }
        .back-vault:hover { background: var(--neon); color: #000; box-shadow: 0 0 15px var(--neon); }

        .header-panel {
            position: fixed; top: 0; left: 0; width: 100%;
            padding: 40px 0; display: flex; flex-direction: column;
            align-items: center; z-index: 100;
            background: linear-gradient(to bottom, var(--bg-dark) 60%, transparent);
        }
        .header-panel h1 { 
            font-size: 3rem; letter-spacing: 20px; font-weight: 900;
            margin: 0; filter: var(--glow); color: #fff;
            text-shadow: 2px 2px 0px var(--warning);
        }

        .stats-bar {
            display: flex; gap: 60px; margin-top: 25px;
            font-family: 'Share Tech Mono'; border: 1px solid var(--neon);
            padding: 12px 60px; background: var(--panel-bg);
            box-shadow: inset 0 0 20px rgba(0, 242, 255, 0.1);
            clip-path: polygon(10% 0, 90% 0, 100% 100%, 0% 100%);
        }
        .stat-box { text-align: center; }
        .stat-label { font-size: 10px; color: var(--neon); opacity: 0.6; letter-spacing: 2px; }
        .stat-value { font-size: 1.8rem; font-weight: bold; color: #fff; display: block; }

        .viewport {
            width: 100vw; height: 100vh;
            display: flex; justify-content: center; align-items: center;
            perspective: 1500px;
        }
        .grid-container {
            display: grid; grid-template-columns: repeat(8, 110px);
            grid-gap: 15px; margin-top: 100px;
        }
        .node {
            width: 110px; height: 145px; cursor: pointer;
            position: relative; transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1), opacity 0.5s ease;
            opacity: 0;
        }
        .node.active { opacity: 1; }
        .node.flipped { transform: rotateY(180deg) !important; }

        .face {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; display: flex;
            justify-content: center; align-items: center;
            border: 1px solid rgba(0, 242, 255, 0.3); border-radius: 4px;
        }
        .back {
            background: rgba(0, 20, 30, 0.9);
            color: var(--neon); font-family: 'Share Tech Mono';
            font-size: 11px; flex-direction: column;
            box-shadow: inset 0 0 15px rgba(0, 242, 255, 0.05);
        }
        .back::before { content: "DATA_LOCKED"; font-size: 8px; margin-bottom: 5px; opacity: 0.4; }
        .front {
            background: rgba(0, 255, 136, 0.08);
            border: 2px solid var(--safe);
            transform: rotateY(180deg);
            font-size: 3rem;
            filter: drop-shadow(0 0 15px var(--safe));
        }

        .footer-panel {
            position: fixed; bottom: 0; left: 0; width: 100%;
            padding: 40px 0; display: flex; flex-direction: column;
            align-items: center; z-index: 100;
            background: linear-gradient(to top, var(--bg-dark) 60%, transparent);
        }
        .override-btn {
            background: transparent; color: var(--neon);
            border: 1px solid var(--neon); padding: 12px 50px;
            font-family: 'Orbitron'; font-weight: bold; cursor: pointer;
            transition: all 0.3s; letter-spacing: 5px;
            clip-path: polygon(0 0, 95% 0, 100% 30%, 100% 100%, 5% 100%, 0 70%);
        }
        .override-btn:hover { background: var(--neon); color: #000; box-shadow: 0 0 30px var(--neon); transform: scale(1.05); }
        #status-msg { font-family: 'Share Tech Mono'; font-size: 12px; margin-top: 20px; color: var(--neon); letter-spacing: 2px; }
        .scanning { animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 0.4; } 50% { opacity: 1; } 100% { opacity: 0.4; } }
    </style>
</head>
<body>

    <div id="abort-overlay">
        <h2 class="abort-text">ABORT</h2>
        <div class="abort-subtext">TERMINATING_SESSION // CONNECTION_REDACTED</div>
    </div>

    <div class="nav-header">
        <button class="back-vault" onclick="exitSequence()">
            <span>&lt;</span> RETURN_TO_VAULT
        </button>
    </div>

    <div class="header-panel">
        <div class="system-header"><h1>JUST_FLIP</h1></div>
        <div class="stats-bar">
            <div class="stat-box">
                <span class="stat-label">ELAPSED_TIME</span>
                <span class="stat-value" id="timer">00:00</span>
            </div>
            <div class="stat-box">
                <span class="stat-label">RECORD_TIME</span>
                <span class="stat-value" id="best-time">--:--</span>
            </div>
        </div>
    </div>

    <div class="viewport">
        <div class="grid-container" id="board"></div>
    </div>

    <div class="footer-panel">
        <button class="override-btn" onclick="initGame()">INITIALIZE_OVERRIDE</button>
        <p id="status-msg" class="scanning">STATUS: AWAITING_INPUT...</p>
    </div>

    <script>
        const board = document.getElementById('board');
        const timerDisplay = document.getElementById('timer');
        const bestDisplay = document.getElementById('best-time');
        const statusMsg = document.getElementById('status-msg');
        const abortOverlay = document.getElementById('abort-overlay');
        
        const icons = ['ðŸ›¡ï¸', 'ðŸ”‘', 'ðŸ“¡', 'ðŸ’¾', 'ðŸ’»', 'ðŸ†”', 'ðŸ•µï¸', 'ðŸ”’'];
        let nodes = [...icons, ...icons];
        let selection = [];
        let matchedNodes = 0;
        let busy = false;
        let seconds = 0;
        let timerInterval;

        // FIXED PATH: Since flipgame is in /games, we need ../ to reach vault.html
        function exitSequence() {
            abortOverlay.style.display = 'flex';
            document.body.classList.add('system-crash');
            document.body.style.opacity = '0';
            setTimeout(() => {
                window.location.href = '../vault.html';
            }, 2000);
        }

        function formatTime(s) {
            return `${Math.floor(s/60).toString().padStart(2,'0')}:${(s%60).toString().padStart(2,'0')}`;
        }

        function initGame() {
            // SAFE AUDIO INIT
            if (!window.audioCtx) window.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            clearInterval(timerInterval);
            board.innerHTML = '';
            selection = [];
            matchedNodes = 0;
            seconds = 0;
            busy = false;
            timerDisplay.innerText = "00:00";
            statusMsg.innerText = "STATUS: DEPLOYING_ENCRYPTED_NODES...";
            const saved = localStorage.getItem('kraken_best');
            bestDisplay.innerText = saved ? formatTime(parseInt(saved)) : "--:--";
            
            nodes.sort(() => Math.random() - 0.5);

            nodes.forEach((icon, index) => {
                const node = document.createElement('div');
                node.className = 'node';
                node.dataset.icon = icon;
                
                const angle = Math.random() * Math.PI * 2;
                const dist = 1000 + Math.random() * 500;
                const startX = Math.cos(angle) * dist;
                const startY = Math.sin(angle) * dist;
                const startRot = (Math.random() - 0.5) * 1000;
                
                node.style.transform = `translate(${startX}px, ${startY}px) rotate(${startRot}deg) scale(0)`;
                node.innerHTML = `
                    <div class="face back">NODE_0x${index.toString(16).toUpperCase()}</div>
                    <div class="face front">${icon}</div>
                `;
                node.onclick = () => flipNode(node);
                board.appendChild(node);
                
                setTimeout(() => {
                    node.classList.add('active');
                    node.style.transform = `translate(0,0) rotate(0deg) scale(1)`;
                }, 40 * index);
            });

            timerInterval = setInterval(() => {
                seconds++;
                timerDisplay.innerText = formatTime(seconds);
            }, 1000);
            
            // Start sound
            playSound(150, 'sawtooth', 0.5, 0.1, 40); 
            nodes.forEach((_, i) => {
                setTimeout(() => {
                    playSound(800 + (i * 50), 'sine', 0.1, 0.02);
                }, 40 * i);
            });
        }

        function flipNode(node) {
            if (busy || node.classList.contains('flipped')) return;
            
            playSound(600, 'triangle', 0.1, 0.05, 1200); 
            node.classList.add('flipped');
            selection.push(node);
            
            if (selection.length === 2) {
                busy = true;
                const [n1, n2] = selection;
                if (n1.dataset.icon === n2.dataset.icon) {
                    matchedNodes += 2;
                    selection = [];
                    busy = false;
                    setTimeout(() => playSound(1000, 'sine', 0.4, 0.05, 2000), 100);
                    if (matchedNodes === nodes.length) endGame();
                } else {
                    setTimeout(() => {
                        n1.classList.remove('flipped');
                        n2.classList.remove('flipped');
                        selection = [];
                        busy = false;
                        playSound(200, 'square', 0.2, 0.03, 50);
                    }, 650);
                }
            }
        }

        function endGame() {
            clearInterval(timerInterval);
            statusMsg.innerText = "BREACH_SUCCESSFUL: ALL_DATA_RECOVERED";
            statusMsg.style.color = "var(--safe)";
            const saved = localStorage.getItem('kraken_best');
            if (!saved || seconds < parseInt(saved)) {
                localStorage.setItem('kraken_best', seconds);
                bestDisplay.innerText = formatTime(seconds);
                statusMsg.innerText = "NEW_RECORD_ESTABLISHED!";
            }
        }

        function playSound(freq, type, duration, vol, sweep = 0) {
            if(!window.audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            if (sweep) {
                osc.frequency.exponentialRampToValueAtTime(sweep, audioCtx.currentTime + duration);
            }
            
            gain.gain.setValueAtTime(vol, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }
    </script>
</body>
</html>