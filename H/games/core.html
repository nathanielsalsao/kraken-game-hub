<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CORE_DEFENSE // PROTOCOL</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        :root { 
            --neon: #00f2ff; 
            --warning: #ff003c;
            --safe: #00ff88;
            --bg-dark: #00040a;
            --glow: drop-shadow(0 0 12px var(--warning));
        }

        html, body { 
            margin: 0; padding: 0; width: 100%; height: 100%;
            background: var(--bg-dark); overflow: hidden; 
            font-family: 'Orbitron', sans-serif; color: #fff; text-transform: uppercase; 
            transition: opacity 2s ease-in-out;
        }


        #abort-overlay {
            position: fixed; inset: 0;
            background: radial-gradient(circle, rgba(20, 0, 5, 0.95) 0%, rgba(0, 0, 0, 1) 100%);
            z-index: 5000; display: none; flex-direction: column;
            justify-content: center; align-items: center; pointer-events: none;
            border-top: 2px solid var(--warning); border-bottom: 2px solid var(--warning);
        }

        #abort-overlay::after {
            content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 3px;
            background: var(--warning); box-shadow: 0 0 20px var(--warning);
            animation: abort-scan 0.6s linear infinite;
        }

        .abort-text {
            font-size: 6rem; font-weight: 900; color: #fff;
            text-shadow: 0 0 20px var(--warning); letter-spacing: 20px;
            animation: glitch-vibrate 0.15s infinite;
        }

        .abort-subtext {
            font-family: 'Share Tech Mono'; font-size: 1.1rem; color: var(--warning);
            padding: 5px 20px; margin-top: 15px; letter-spacing: 5px; border-left: 2px solid var(--warning);
        }

        @keyframes abort-scan { 0% { top: 0%; opacity: 0; } 50% { opacity: 1; } 100% { top: 100%; opacity: 0; } }
        @keyframes glitch-vibrate {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px) skewX(2deg); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px) skewX(-2deg); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }

        .system-crash {
            filter: brightness(0.4) contrast(1.5) blur(15px) grayscale(1);
            transition: all 2s cubic-bezier(0.4, 0, 1, 1) !important;
        }

  
        .nav-header { position: fixed; top: 20px; left: 20px; z-index: 200; }
        .back-vault {
            background: transparent; border: 1px solid var(--neon);
            color: var(--neon); font-family: 'Share Tech Mono';
            padding: 8px 15px; cursor: pointer; text-decoration: none;
            font-size: 12px; letter-spacing: 2px; transition: 0.3s;
            clip-path: polygon(0 0, 100% 0, 85% 100%, 0% 100%);
            display: flex; align-items: center; gap: 8px;
        }
        .back-vault:hover { background: var(--neon); color: #000; box-shadow: 0 0 15px var(--neon); }

    
        body::before {
            content: " "; position: absolute; inset: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.2) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
            background-size: 100% 3px, 3px 100%; z-index: 1000; pointer-events: none;
        }

        canvas { position: fixed; top: 0; left: 0; z-index: 1; }

        .secure-data {
            position: fixed; font-family: 'Share Tech Mono'; font-size: 12px; color: var(--neon);
            opacity: 0.8; z-index: 600; pointer-events: none; line-height: 1.5; letter-spacing: 1px;
        }
        .top-left-info { top: 80px; left: 40px; border-left: 3px solid var(--neon); padding-left: 15px; }
        .bottom-right-info { bottom: 80px; right: 40px; text-align: right; border-right: 3px solid var(--neon); padding-right: 15px; }

        #score-display {
            position: fixed; top: 12%; left: 50%; transform: translateX(-50%);
            font-size: 6rem; font-weight: 900; color: var(--neon);
            text-shadow: 0 0 30px var(--neon); z-index: 10; pointer-events: none;
        }

        #menu-overlay {
            position: fixed; inset: 0; background: rgba(0, 4, 10, 0.95);
            display: flex; justify-content: center; align-items: center; z-index: 2000;
        }

        .panel {
            border: 2px solid var(--neon); padding: 60px; text-align: center;
            background: rgba(0, 242, 255, 0.02); backdrop-filter: blur(15px);
        }

        button.start-btn {
            background: var(--neon); border: none; color: var(--bg-dark);
            padding: 18px 50px; font-family: 'Orbitron'; font-weight: 900; cursor: pointer;
            letter-spacing: 4px; transition: 0.2s; margin-top: 30px;
        }
        button.start-btn:hover { background: #fff; box-shadow: 0 0 40px #fff; transform: scale(1.05); }

        .glitch { color: var(--warning); animation: flash 0.1s infinite; text-shadow: 0 0 20px var(--warning); }
        @keyframes flash { 0%, 100% { opacity: 1; transform: skewX(0deg); } 50% { opacity: 0.7; transform: skewX(10deg); } }
    </style>
</head>
<body>

    <div id="abort-overlay">
        <h2 class="abort-text">ABORT</h2>
        <div class="abort-subtext">TERMINATING_SESSION // CONNECTION_REDACTED</div>
    </div>

    <div class="nav-header">
        <button class="back-vault" onclick="exitSequence()">
            <span>&lt;</span> RETURN_TO_VAULT
        </button>
    </div>

    <div class="secure-data top-left-info">
        NODE: FIREWALL_BETA<br>
        THREAT: <span id="threat-lvl" style="font-weight: bold;">STABLE</span><br>
        UPTIME: <span id="uptime-val">0.00</span>s
    </div>

    <div class="secure-data bottom-right-info">
        HULL_INTEGRITY: 100%<br>
        ID: <span id="dynamic-id">0x77-X9</span><br>
        SIGNAL: <span style="color:var(--safe)">ENCRYPTED</span>
    </div>

    <div id="score-display">00</div>

    <div id="menu-overlay">
        <div class="panel">
            <h1 id="title" style="letter-spacing: 20px; font-size: 3.5rem; margin: 0;">CORE_DEFENSE</h1>
            <p id="subtitle" style="font-family: 'Share Tech Mono'; opacity: 0.6; margin-top: 15px;">INTERCEPT ALL INBOUND MALWARE PACKETS</p>
            <button class="start-btn" onclick="startGame()">INITIALIZE_SHIELD</button>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    let w, h, score = 0, playing = false, frame = 0;
    let shieldAngle = 0, bullets = [], drops = [];
    let impactGlow = 0;

    function init() {
        w = canvas.width = window.innerWidth;
        h = canvas.height = window.innerHeight;
        drops = new Array(Math.floor(w / 20)).fill(1);
    }
    window.addEventListener('resize', init);
    init();

    // Cinematic Exit
    function exitSequence() {
        playing = false; 
        const abortOverlay = document.getElementById('abort-overlay');
        abortOverlay.style.display = 'flex';
        document.body.classList.add('system-crash');
        document.body.style.opacity = '0';

        setTimeout(() => {
            window.location.href = '../vault.html';
        }, 2000);
    }

    window.addEventListener('mousemove', e => {
        shieldAngle = Math.atan2(e.clientY - h/2, e.clientX - w/2);
    });

    function spawnBullet() {
        const angle = Math.random() * Math.PI * 2;
        const dist = Math.max(w, h) * 0.7;
        bullets.push({
            x: w/2 + Math.cos(angle) * dist,
            y: h/2 + Math.sin(angle) * dist,
            angle: angle,
            speed: 4.5 + (score / 10),
            history: []
        });
    }

    function startGame() {
        score = 0; bullets = []; frame = 0; playing = true;
        document.getElementById('menu-overlay').style.display = 'none';
        document.getElementById('score-display').innerText = "00";
        document.getElementById('title').classList.remove('glitch');
        animate();
    }

    function die() {
        playing = false;
        document.getElementById('menu-overlay').style.display = 'flex';
        document.getElementById('title').innerText = "KERNEL_PANIC";
        document.getElementById('title').classList.add('glitch');
        document.getElementById('subtitle').innerText = "FINAL DATA CACHE: " + score;
    }

    function animate() {
        if(!playing) return;

        ctx.fillStyle = 'rgba(0, 4, 10, 0.2)';
        ctx.fillRect(0, 0, w, h);

   
        ctx.fillStyle = '#00f2ff08';
        ctx.font = '14px monospace';
        drops.forEach((y, i) => {
            const text = String.fromCharCode(Math.random() * 128);
            ctx.fillText(text, i * 20, y * 20);
            if (y * 20 > h && Math.random() > 0.98) drops[i] = 0;
            drops[i]++;
        });


        document.getElementById('uptime-val').innerText = (frame / 60).toFixed(2);
        if(frame % 30 === 0) {
            document.getElementById('dynamic-id').innerText = "0x" + Math.floor(Math.random()*0xFFFF).toString(16).toUpperCase();
        }

 
        const pulse = 25 + Math.sin(frame * 0.1) * 5;
        ctx.beginPath();
        ctx.fillStyle = 'var(--neon)';
        ctx.shadowBlur = 15 + impactGlow; 
        ctx.shadowColor = 'var(--neon)';
        ctx.arc(w/2, h/2, pulse, 0, Math.PI*2);
        ctx.fill();
        if(impactGlow > 0) impactGlow -= 2;


        ctx.beginPath();
        ctx.strokeStyle = '#fff';
        ctx.lineWidth = 6;
        ctx.shadowBlur = 10; ctx.shadowColor = '#fff';
        ctx.arc(w/2, h/2, 85, shieldAngle - 0.7, shieldAngle + 0.7);
        ctx.stroke();
        ctx.shadowBlur = 0;

        if(frame % Math.max(3, 20 - Math.floor(score/8)) === 0) spawnBullet();

        bullets.forEach((b, i) => {
            b.history.push({x: b.x, y: b.y});
            if(b.history.length > 8) b.history.shift();

            b.x += Math.cos(b.angle + Math.PI) * b.speed;
            b.y += Math.sin(b.angle + Math.PI) * b.speed;

    
            ctx.beginPath();
            ctx.strokeStyle = 'rgba(255, 0, 60, 0.4)';
            ctx.lineWidth = 2;
            b.history.forEach(pos => ctx.lineTo(pos.x, pos.y));
            ctx.stroke();

   
            ctx.fillStyle = 'var(--warning)';
            ctx.shadowBlur = 15; ctx.shadowColor = 'var(--warning)';
            ctx.beginPath();
            ctx.arc(b.x, b.y, 5, 0, Math.PI*2);
            ctx.fill();
            ctx.shadowBlur = 0;

            const dx = w/2 - b.x, dy = h/2 - b.y;
            const dist = Math.sqrt(dx*dx + dy*dy);

            if(dist < 92 && dist > 75) {
                const bAngle = Math.atan2(b.y - h/2, b.x - w/2);
                let diff = Math.abs(bAngle - shieldAngle);
                if (diff > Math.PI) diff = Math.PI * 2 - diff;
                if(diff < 0.75) {
                    bullets.splice(i, 1);
                    score++;
                    impactGlow = 30;
                    document.getElementById('score-display').innerText = score < 10 ? '0'+score : score;
                }
            }
            if(dist < pulse) die();
        });

        frame++;
        requestAnimationFrame(animate);
    }
</script>
</body>
</html>